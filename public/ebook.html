<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D√©tail du livre</title>
  <link rel="stylesheet" href="/custom.css?v=7">
  <style>
    .container{max-width:1000px;margin:20px auto;padding:0 14px}
    .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 22px rgba(0,0,0,.08)}
    .cover-lg{width:100%;max-width:520px;height:auto;border-radius:8px;display:block;margin:0 auto 16px}
    .btn{display:inline-block;padding:10px 16px;border-radius:8px;background:#0d6efd;color:#fff;text-decoration:none}
    .btn-outline{background:transparent;color:#0d6efd;border:1px solid #0d6efd}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
    .viewer{margin-top:14px;border:1px solid #e5e7eb;border-radius:10px;overflow:hidden}
    .viewer iframe{width:100%;height:75vh;border:0}
    .muted{color:#6b7280}
  </style>
</head>
<body>
  <main class="container">
    <p><a class="btn btn-outline" href="/">&larr; Retour</a></p>
    <div id="ebookDetail" class="card">Chargement‚Ä¶</div>
  </main>

  <script>
  (async () => {
    const params = new URLSearchParams(location.search);
    const id = Number(params.get('id'));
    const box = document.getElementById('ebookDetail');

    if (!id) { box.innerHTML = "<p>Identifiant manquant.</p>"; return; }

    try {
      const res = await fetch('/api/ebooks/' + id);
      if (!res.ok) { box.innerHTML = "<p>Impossible de charger ce livre.</p>"; return; }
      const e = await res.json();

      const cover = e.cover_path ? `<img class="cover-lg" src="${e.cover_path}" alt="Couverture">` : "";
      const meta  = `
        <h1>${e.title || 'Sans titre'}</h1>
        <p><strong>Auteur :</strong> ${e.author || '-'}</p>
        ${e.language ? `<p><strong>Langue :</strong> ${e.language}</p>` : ''}
        ${e.categories ? `<p><strong>Cat√©gories :</strong> ${e.categories}</p>` : ''}
        ${e.description ? `<p>${e.description}</p>` : ''}
      `;

      // Actions : ouvrir dans le lecteur + t√©l√©chargement
      const actions = e.pdf_path ? `
        <div class="actions">
          <a class="btn" href="${e.pdf_path}" target="_blank" rel="noopener">üìñ Ouvrir dans un nouvel onglet</a>
          <a class="btn btn-outline" href="${e.pdf_path}" download>‚¨áÔ∏è T√©l√©charger le PDF</a>
        </div>
      ` : '<p class="muted">PDF indisponible.</p>';

      // Lecteur int√©gr√© (si PDF dispo)
      const viewer = e.pdf_path ? `
        <div class="viewer">
          <iframe src="${e.pdf_path}#view=FitH" title="Lecteur PDF"></iframe>
        </div>
        <p class="muted" style="margin-top:8px">
          Si le lecteur int√©gr√© ne s‚Äôaffiche pas, utilisez le bouton ‚ÄúOuvrir dans un nouvel onglet‚Äù.
        </p>
      ` : '';

      box.innerHTML = `${cover}${meta}${actions}${viewer}`;
    } catch (err) {
      console.error(err);
      box.innerHTML = "<p>Erreur inattendue.</p>";
    }
  })();
  </script>
</body>
</html>
