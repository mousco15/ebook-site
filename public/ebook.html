<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Détail du livre</title>
  <link rel="stylesheet" href="/custom.css?v=10">
  <link rel="preload" as="image" href="/hero.jpg">
</head>
<body>
  <main class="container card">
    <a href="/" style="text-decoration:none">← Retour</a>
    <div id="detail" style="margin-top:12px">Chargement…</div>
  </main>

  <script>
    const qp = new URLSearchParams(location.search);
    const id = qp.get('id');

    async function load() {
      if (!id) { document.getElementById('detail').textContent='Livre introuvable.'; return; }
      const r = await fetch('/api/ebooks/' + encodeURIComponent(id));
      if (!r.ok) { document.getElementById('detail').textContent='Livre introuvable.'; return; }
      const e = await r.json();
      document.getElementById('detail').innerHTML = `
        <div style="display:flex;gap:16px;flex-wrap:wrap">
          ${e.cover_path ? `<img src="${e.cover_path}" alt="" style="width:260px;height:360px;object-fit:cover;border-radius:12px">` : ''}
          <div style="flex:1;min-width:260px">
            <h2 style="margin:0 0 6px">${e.title || ''}</h2>
            <div style="opacity:.8">${e.author || ''}</div>
            <div style="opacity:.7;margin-top:6px">${e.language || ''} • ${e.categories || ''}</div>
            ${e.description ? `<p style="margin-top:10px">${e.description}</p>` : ''}
            ${e.pdf_path ? `<p style="margin-top:10px"><a class="btn" href="${e.pdf_path}" target="_blank" rel="noopener">Télécharger le PDF</a></p>` : ''}
          </div>
        </div>
        ${e.pdf_path ? `<h3 style="margin-top:18px">Lecture en ligne</h3>
        <iframe src="${e.pdf_path}#view=fitH" style="width:100%;height:80vh;border:none;border-radius:12px;background:#fafafa"></iframe>` : ''}
      `;
    }
    load();
  </script>
</body>
</html>
