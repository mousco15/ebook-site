<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ma BibliothÃ¨que</title>
  <link rel="stylesheet" href="/custom.css">
  <style>
    .grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(210px,1fr)); gap: 16px; }
    .card { background: #fff; border-radius: 12px; padding: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
    .cover { width: 100%; height: 280px; object-fit: cover; border-radius: 8px; background:#f4f6f8; }
    .title { font-weight: 700; margin: 8px 0 4px; }
    .author { color: #666; font-size: .95rem; margin-bottom: 8px; }
    .actions a { display:inline-block; margin-right:10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“š Ma BibliothÃ¨que</h1>

    <div style="margin:16px 0;">
      <input id="search" type="text" placeholder="Rechercher un livre..." style="width:100%;max-width:520px;padding:12px;border-radius:8px;border:1px solid #ddd;">
    </div>

    <div id="ebook-list" class="grid"></div>
    <p id="empty" style="display:none;color:#666;">Aucun livre pour lâ€™instant.</p>
  </div>

  <script>
    async function loadEbooks(q = '') {
      const list = document.getElementById('ebook-list');
      const empty = document.getElementById('empty');
      list.innerHTML = '';
      empty.style.display = 'none';

      try {
        const url = q ? `/api/ebooks?q=${encodeURIComponent(q)}` : '/api/ebooks';
        const res = await fetch(url, { credentials: 'include' });
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) {
          empty.style.display = 'block';
          return;
        }

        list.innerHTML = data.map(e => `
          <div class="card">
            <img class="cover" src="${e.cover_path || '/assets/placeholder-cover.svg'}" alt="">
            <div class="title">${e.title || ''}</div>
            <div class="author">${e.author || ''}</div>
            <div class="actions">
              <a href="/ebook?id=${encodeURIComponent(e.id)}">Voir</a>
              ${e.pdf_path ? `<a href="${e.pdf_path}" target="_blank" rel="noopener">TÃ©lÃ©charger</a>` : ''}
            </div>
          </div>
        `).join('');
      } catch (err) {
        console.error(err);
        empty.textContent = 'Erreur de chargement.';
        empty.style.display = 'block';
      }
    }

    document.getElementById('search').addEventListener('input', (e) => {
      loadEbooks(e.target.value.trim());
    });

    loadEbooks();
  </script>
</body>
</html>
