<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Admin • Ebooks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/custom.css?v=3">
</head>
<body class="page-admin">

  <!-- Force credentials=include sur tous les fetch -->
  <script>
  (function () {
    const orig = window.fetch;
    window.fetch = function (url, opts = {}) {
      if (!opts.credentials) opts.credentials = 'include';
      return orig(url, opts);
    };
  })();
  </script>

  <!-- Vérifie la session au chargement -->
  <script>
  (async () => {
    try {
      const me = await fetch('/api/me', { credentials: 'include' }).then(r => r.json());
      if (!me.user) {
        location.href = '/login.html';
        return;
      }
      // Tu peux afficher l'email ici si tu veux
      document.getElementById('who').textContent = me.user;
    } catch (e) {
      location.href = '/login.html';
    }
  })();
  </script>

  <main class="container">
    <header class="admin-header">
     <h1 class="admin-title">
  <span class="icon" aria-hidden="true">
    <!-- Petit cahier en SVG inline (pas besoin d'image externe) -->
    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="4" y="3" width="14" height="18" rx="2" ry="2" fill="#1e73be" opacity="0.12"/>
      <rect x="6" y="5" width="10" height="14" rx="1.2" fill="#1e73be" opacity="0.18"/>
      <path d="M18 3v18" stroke="#1e73be" stroke-width="2"/>
      <circle cx="18" cy="7" r="0.9" fill="#1e73be"/>
      <circle cx="18" cy="11" r="0.9" fill="#1e73be"/>
      <circle cx="18" cy="15" r="0.9" fill="#1e73be"/>
      <path d="M8 8h6M8 11h6M8 14h6" stroke="#1e73be" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
  </span>
  Ajouter / Gérer les Ebooks
</h1>

      <div class="admin-meta">
        Connecté en tant que <strong id="who">…</strong>
        <button id="logoutBtn" class="btn-outline">Se déconnecter</button>
      </div>
    </header>

    <!-- … ici garde ton formulaire et tes listes existants … -->
    <!-- IMPORTANT : ne change pas les attributs name="cover" et name="pdf" sur les <input type="file"> -->

  </main>

  <script>
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    await fetch('/api/logout', { method:'POST', credentials:'include' });
    location.href = '/login.html';
  });
  </script>
</body>
</html>
