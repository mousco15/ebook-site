<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Admin • Ebooks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/custom.css?v=3">
</head>
<body class="page-admin">

  <!-- Force credentials=include sur tous les fetch -->
  <script>
  (function () {
    const orig = window.fetch;
    window.fetch = function (url, opts = {}) {
      if (!opts.credentials) opts.credentials = 'include';
      return orig(url, opts);
    };
  })();
  </script>

  <!-- Vérifie la session au chargement -->
  <script>
  (async () => {
    try {
      const me = await fetch('/api/me', { credentials: 'include' }).then(r => r.json());
      if (!me.user) {
        location.href = '/login.html';
        return;
      }
      // Tu peux afficher l'email ici si tu veux
      document.getElementById('who').textContent = me.user;
    } catch (e) {
      location.href = '/login.html';
    }
  })();
  </script>

  <main class="container">
    <header class="admin-header">
      <h1>➕ Ajouter / Gérer les Ebooks</h1>
      <div class="admin-meta">
        Connecté en tant que <strong id="who">…</strong>
        <button id="logoutBtn" class="btn-outline">Se déconnecter</button>
      </div>
    </header>

    <!-- … ici garde ton formulaire et tes listes existants … -->
    <!-- IMPORTANT : ne change pas les attributs name="cover" et name="pdf" sur les <input type="file"> -->

  </main>

  <script>
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    await fetch('/api/logout', { method:'POST', credentials:'include' });
    location.href = '/login.html';
  });
  </script>
</body>
</html>
